{"version":3,"sources":["../../src/index.js"],"names":["PathObject","obj","path","srcObj","pathList","_spreadPath","split","forEach","_splitPath","prop","newValue","callback","correspond","index","val","Array","isArray","length","fromPathList","move","toPath","src","target","_deepClone","newVal","push","JSON","parse","stringify","arr","pop","key","indexOf","join","i","_index","newArr","slice","Adapter","promise","taskQueue","response","Promise","then","data","_execTask","catch","catchcallback","error","all","Object","values","keys","res","taskName","argument","apply","prototype","_setTask","arguments","list","remove","fromPath","value","_DataAdapter","resolve","DataAdapter"],"mappings":"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","file":"index.js","sourcesContent":["/*\nProject: Adapter\nAuthor: WuWanQiang\n */\n\nclass PathObject {\n    constructor(obj, path) {\n        this.srcObj = obj;\n        this.pathList = [];\n        this._spreadPath(path.split('.'), this.srcObj);\n    }\n\n    remove() {\n        this.pathList.forEach(path => {\n            let {obj, prop} = this._splitPath(path);\n            delete obj[prop];\n        });\n    }\n    value(newValue, callback, correspond) {\n        this.pathList.forEach((path, index) => {\n            let {obj, prop} = this._splitPath(path);\n            let val = newValue;\n\n            // 传入相同长度数组则一一对应\n            if (correspond && Array.isArray(newValue) && newValue.length === this.pathList.length) {\n                val = newValue[index];\n            }\n\n            if (callback) {\n                obj[prop] = callback(obj[prop], index);\n            } else {\n                obj[prop] = val;\n            }\n        });\n    }\n    index(fromPathList, move, correspond) {\n        // 一一对应\n        if (correspond && fromPathList.length === this.pathList.length) {\n            this.pathList.forEach((toPath, index) => {\n                let src = this._splitPath(fromPathList[index]);\n                let target = this._splitPath(toPath);\n                target.obj[target.prop] = this._deepClone(src.obj[src.prop]);\n\n                if (move) {\n                    delete src.obj[src.prop];\n                }\n            });\n        } else {\n            this.pathList.forEach(toPath => {\n                let newVal = [];\n                fromPathList.forEach(path => {\n                    let src = this._splitPath(path);\n                    newVal.push(src.obj[src.prop]);\n                    if (move) {\n                        delete src.obj[src.prop];\n                    }\n                });\n                newVal = newVal.length > 1 ? newVal : newVal[0];\n\n                let target = this._splitPath(toPath);\n                target.obj[target.prop] = this._deepClone(newVal);\n            });\n        }\n    }\n\n    _deepClone(obj) {\n        return JSON.parse(JSON.stringify(obj));\n    }\n    _splitPath(path) {\n        let arr = path.split('.');\n        let prop = arr.pop();\n        let obj = this.srcObj;\n\n        arr.forEach(key => {\n            obj = obj[key];\n        });\n        // console.log(obj, prop);\n        return {\n            obj,\n            prop\n        };\n    }\n    _spreadPath(arr, obj) {\n        if (arr.indexOf('[]') === -1) {\n            this.pathList.push(arr.join('.'));\n        } else {\n            for (let i = 0; i < arr.length; i++) {\n                let key = arr[i];\n                if (key !== '[]') {\n                    obj = obj[key];\n                } else {\n                    obj.forEach((val, _index) => {\n                        let newArr = arr.slice();\n                        newArr[i] = _index;\n                        this._spreadPath(newArr, this.srcObj);\n                    });\n                    break;\n                }\n            }\n        }\n    }\n}\n\nclass Adapter {\n\n    taskQueue = [];\n\n    response = {};\n\n    constructor(promise) {\n        if (promise instanceof Promise) {\n            promise.then(data => {\n                this.response = data;\n                this._execTask();\n            }).catch(error => {\n                if (this.catchcallback) {\n                    this.catchcallback(error);\n                } else {\n                    throw error;\n                }\n            });\n        } else {\n            Promise.all(Object.values(promise)).then(res => {\n                Object.keys(promise).forEach((key, index) => {\n                    this.response[key] = res[index];\n                });\n                this._execTask();\n            }).catch(error => {\n                if (this.catchcallback) {\n                    this.catchcallback(error);\n                } else {\n                    throw error;\n                }\n            });\n        }\n    }\n\n    _execTask() {\n\n        this.taskQueue.forEach(({taskName, argument}) => {\n            this[taskName].apply(this, Array.prototype.slice.apply(argument));\n        });\n    }\n\n    _setTask(taskName, argument) {\n        this.taskQueue.push({\n            taskName,\n            argument\n        });\n        return this;\n    }\n\n    remove() {\n        return this._setTask('_remove', arguments);\n    }\n\n    _remove(list = []) {\n        list.forEach(path => {\n            new PathObject(this.response, path).remove();\n        });\n    }\n\n    index() {\n        return this._setTask('_index', arguments);\n    }\n    _index(list = []) {\n        list.forEach(({ toPath, fromPath, move = false, correspond = true }) => {\n            new PathObject(this.response, toPath).index(new PathObject(this.response, fromPath).pathList, move, correspond);\n        });\n    }\n\n    value() {\n        return this._setTask('_value', arguments);\n    }\n    _value(list = []) {\n        list.forEach(({ path, value, callback = null, correspond = true }) => {\n            new PathObject(this.response, path).value(value, callback, correspond);\n        });\n    }\n\n    then() {\n        return this._setTask('_then', arguments);\n    }\n    _then(callback) {\n        callback(this._deepClone(this.response));\n    }\n\n    catch(callback) {\n        this.catchcallback = callback;\n    }\n    _catch(error) {\n\n    }\n\n    _deepClone(obj) {\n        return JSON.parse(JSON.stringify(obj));\n    }\n}\n\nclass _DataAdapter extends Adapter {\n    constructor(data) {\n        super(Promise.resolve(data));\n    }\n};\n\nexport default Adapter;\nexport const DataAdapter = _DataAdapter;\n"]}